var app=angular.module("movieApp",[]),imageLoaded=!1;app.directive("imageonload",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){imageLoaded=!0,console.log("image loaded")})}}}),app.controller("MovieController",["$scope","$http","$interval",function(a,b,c){a.inputMovie={},a.getMovieInfo=function(){a.showImage=!1,a.movieUrl="http://omdbapi.com/?t="+a.inputMovie.title+"&y="+a.inputMovie.year+"&plot=short&r=json",b.get(a.movieUrl).then(function(b){a.newMovie={},a.newMovie=b.data,a.waitForLoad(),b="",a.movie={}})},a.waitForLoad=function(){c(function(){return imageLoaded?(a.imageLoading=!1,a.showImage=!0,void(imageLoaded=!1)):void 0},100)},a.saveMovie=function(){console.log("POST newMovie",a.newMovie);var c="http://netflixroulette.net/api/api.php?title="+a.newMovie.Title;b.get(c).then(function(c){console.log("Netflix response:",c),200==c.status&&(a.newMovie.netflixAvailable=!0);var d=a.newMovie;console.log("$scope.newMovie.netflixAvailable",a.newMovie.netflixAvailable),console.log("netflixed:",d),b.post("/save",d).then(function(b){200!==b.status,a.getMovieCollection()})},function(c){console.log("netflix available made false"),a.newMovie.netflixAvailable=!1,b.post("/save",a.newMovie).then(function(b){200!==b.status,a.getMovieCollection()})})},a.getMovieCollection=function(){return b.get("/movies").then(function(b){if(200!==b.status)throw new Error("Failed to get movies");return a.movies=b.data,a.movies})},a.getMovieCollection()}]);